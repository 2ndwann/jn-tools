<html>
<body>
<h1>Calendar</h1>

<h2>The current time and date is:</h2>
<p>Year <span id="year">0</span>, month <span id="month">0</span>, day <span id="day">0</span></p>
<p><span id="daysElapsed">0</span> days have elapsed since the beginning of this year.</p>
<p><span id="season"></span> is the current season.</p>

<h2>Info:</h2>
<p>There are 72 days in a Jehvnar year. In this calendar system, the year is divided into 4 "months", with each month totalling 18 days.</p>

<script>
const jehvnarEpoch = 1590883200000; // The Jehvnar epoch
const monthsInAYear = 4; // How many months there are in a year
const daysInAYear = 72; // How many days are in a year

let unixTimeNow; // The unix millis time now since Unix epoch
let jehvnarTimeNow; // The Jehvnar time now in milliseconds

let timeOffset = 0; // Ingame time offset in milliseconds (probably gonna be used later)

let getTodayUTC = () => {
	let todayDate = new Date().getUTCDate(); // Get today's date
	let todayMonth = new Date().getUTCMonth() + 1; // Get today's month
	let todayYear = new Date().getUTCFullYear(); // Get today's year
	let today = new Date(String(todayYear) + '-' + String(todayMonth).padStart(2, '0') + '-' + String(todayDate).padStart(2, '0') + 'T00:00:00-00:00'); // Get today when it started at GMT 00:00
	
	return today;
}

// Format Jehvnar Reckoning year
let getYear = (jehvnarTime) => {
	return Math.round(jehvnarTime / 86400000);
}

let getDaysElapsed = (jehvnarTime) => {	
	let today = getTodayUTC();
	
	let timeElapsedForToday = unixTimeNow - today.getTime();
	
	timeElapsedForToday = timeElapsedForToday / 1200000 // to minecraft days
	
	return Math.round(timeElapsedForToday);

}

// Format month based on 4-month system
let getMonth = (jehvnarTime) => {
	let today = getTodayUTC();
	
	let timeElapsedForToday = unixTimeNow - today.getTime();
	
	timeElapsedForToday = timeElapsedForToday / 60000 // to minutes
	timeElapsedForToday = timeElapsedForToday / 20 // to minecraft days
	
	let daysElapsedThisYear = timeElapsedForToday;
	let month;
	
	// basically 
	if (daysElapsedThisYear > 0 && daysElapsedThisYear <= 18) { month = 1; }
	if (daysElapsedThisYear > 18 && daysElapsedThisYear <= 36) { month = 2; }
	if (daysElapsedThisYear > 36 && daysElapsedThisYear <= 54) { month = 3; }
	if (daysElapsedThisYear > 54 && daysElapsedThisYear <= 72) { month = 4; }
	
	return month;
}

let getDay = (jehvnarTime) => {
	//todo
	let today = getTodayUTC();
	
	let timeElapsedForToday = unixTimeNow - today.getTime();
	
	timeElapsedForToday = timeElapsedForToday / 60000 // to minutes
	timeElapsedForToday = timeElapsedForToday / 20 // to minecraft days
	
	let daysElapsedThisYear = timeElapsedForToday;
	
	let month = getMonth(jehvnarTimeNow);
	
	// get how many days elapsed since this month
	let day;
	return day;
}


// Update the time
let updateTime = () => {
	unixTimeNow = Date.now(); // Update unix time
	jehvnarTimeNow = unixTimeNow - jehvnarEpoch + timeOffset; // Derive Jehvnar millisecond time
	
	// Update timestamps
	document.getElementById('year').innerHTML = getYear(jehvnarTimeNow);
	document.getElementById('daysElapsed').innerHTML = getDaysElapsed(jehvnarTimeNow);
	document.getElementById('month').innerHTML = getMonth(jehvnarTimeNow);
	document.getElementById('day').innerHTML = getDay(jehvnarTimeNow);
}
setInterval(updateTime, 1); // Update the time
</script>
</body>
</html>